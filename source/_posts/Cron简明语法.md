---
title: Cron 简明语法
toc: true
comments: true
date: 2020-07-11 10:17:11
updated: 2020-09-16 14:57:00
categories:
  - 技术
tags:
  - cron
description: cron 表达式用于定义定时任务的执行策略，语法简单明了。本文目标是成为 cron 表达式的 cheatsheet。
---

## 前言
通过`cron 表达式`可以让计算机在**固定的时间点**或**特定时间间隔**下执行指定任务。时间间隔的单位可以是秒<sup>*</sup>、分钟、小时、日、月、周、年的**任意组合**。非常适合周期性的日志、数据分析或数据备份等运维或管理工作。cron 该词来源于希腊语 chronos（χρόνος），原意是时间。
<font color=#aaaaaa size=1>注意：crontab 最小单位是分钟，Quartz 最小时间单位是秒。</font>


## 语法规则
`cron 表达式`是一个字符串，该字符串分为 **7**个**`域`**，相邻的两个域由一个`space`隔开。最后一个`域`（年）**可省略**，实际应用中多为前 6 个`域`。
```
[秒] [分] [时] [日] [月] [周] [年]
[Seconds] [Minutes] [Hours] [DayofMonth] [Month] [DayofWeek] [Year]
```
<font color=#aaaaaa size=1>注意：当“周”域为“*”时，容易错误理解为每周，而每周不是个时间点，显然这么理解是有误的，实际上应理解作当前周的每一天，等同于每月的每天，即每天。其实结合其英文原文“DayofWeek”还是很好理解的。这里我找不到更合适的翻译，就仍译作“周”。</font>

### 各域规则
|域|是否必填|取值范围|通配符|
|-|:-:|-|-|
|秒|是|0-59           |, - * /        |
|分|是|0-59           |, - * /        |
|时|是|0-23           |, - * /        |
|日|是|1-31           |, - * / ? L W C|
|时|是|1-12 或 JAN-DEC|, - * /        |
|周|是|1-7 或 SUN-SAT |, - * / ? L C #|
|年|否|1970-2099      |, - * /        |

### 域的通配符
<font color=#aaaaaa size=1>注意：下列各通配符的中文释义是按照我理解及参考文献后个人定义的。</font>
<font color=#aaaaaa size=1>注意：cron 表达式对字母大小写不敏感。</font>
- `,` 逗号，表**列表值**，类比数组的各元素，是并列关系。
  - `0 0 0 9,15 * ?`
    （每月的）9 号和 15 号（的 00:00:00）各触发一次，即每 15 分钟触发一次。

  - `0 0,15,30,45 * * * ?`
    （每月的每天的）每小时的 0 分、15 分、30 分、45 分（的 0 秒）各触发一次，即每 15 分钟触发一次。


- `-` 中划线，表**连续区间值**，指定区间内所有可能的值均可触发。
  - `0 0 9-13 * * ?`
    （每月的）每天的 09:00-13:00 期间，每小时（的 0 分 0 秒）触发一次。等价于`0 0 9,10,11,12,13 * * ?`。


- `*` 星号，表**任意值**，取值范围内任意可能的值。
  - `* * * * * ?`
    （每月的每天的每小时的每分的）每秒触发一次。

  - `0 0 0 * * ?`
    （每月的）每天 00:00:00 触发一次。


- `/` 斜杠，表**周期值**，根据指定起始时间点和周期，间歇性触发。
  - `0 0 */6 * * ?`
    从 00:00:00 开始，每 6 小时触发一次。等价于`0 0 0,6,12,18 * * ?`。
  - `11/10 * * * * ?`
    （每月的每天的每小时内，）从每分钟的第 11 秒开始，每 10 秒触发一次。等价于`11,21,31,41,51 * * * * ?`。


- `?` 问号，表**未说明的值**，即不关心它为何值。如果“日”或“周”域都指定数值显然容易冲突，即使不冲突也会是重复指定，故常仅指定其一。
  - `0 0 12 * * ?`
    （每月的）每天的 12:00:00 触发一次。
  - `0 0 12 ? * *`
    （每月的）每天的 12:00:00 触发一次。


- `L` 字母L（Last），表**最后一个值**，只能在“日”和“周”域中使用。在“日”域中时，表**当月的最后一天**；在“周”域中时，表**当周最后一天（周六）**，等同于“7”或“SAT”。若在“L”前加数字，则表示**最后一个该数据**，如在“周”域设置“7L”表本月最后一个周六。
  - `0 0 12 L * ?`
    每月的最后一天的 12:00:00 触发一次。
  - `0 0 12 ? * L`
    （每月的）每周的最后一天（即周六）的 12:00:00 触发一次。
  - `0 0 12 ? * 4L`
    （每月的）最后一个周三的 12:00:00 触发一次。


- `W` 字母W（Week），表**最接近指定日的工作日（周一至周五）**，只能在“日”域中使用。
  - `0 0 12 15W * ?` <font color=#aaaaaa size=1>假设 15 日是周一</font>
    （每月的）15 日的 12:00:00 触发一次。
  - `0 0 12 15W * ?` <font color=#aaaaaa size=1>假设 15 日是周六</font>
    （每月的）14 日的 12:00:00 触发一次。
  - `0 0 12 15W * ?` <font color=#aaaaaa size=1>假设 15 日是周天</font>
    （每月的）16 日的 12:00:00 触发一次。

  注意：此用法**只在当前月内计算，不会超出本月范围**。如本月最后一天是 31 日（周天），那么`31W`表示当月的 29 日（周五）。也可用`LW`来指定当前月的最后一个工作日。


- `C` 字母C（Calendar），表**啊**，只能在“日”或“周”域中使用。
  - `0 0 0 5C * ?`
    网上没找到结合实例的解释，没搞懂。遇上再说。
  - `0 0 0 ? * 5C`
    网上没找到结合实例的解释，没搞懂。遇上再说。


- `#` 井号，`a#b`表**每月的第b个周a**，只能在“周”域中使用。
  - `0 0 0 ? * 1#3`
    每月的第 3 个周天的 00:00:00 触发。
  - `0 0 0 ? * 3#2`
    每月的第 2 个周二的 00:00:00 触发。


## 综合实例

- `0 */1 * * * ?`
  每隔 1 分钟触发一次

- `0 0/1 * * * ?`
  每隔 1 分钟触发一次

- `0 0 22 * * ?`
  每天 22:00:00 触发一次

- `0 0 22 ? * *`
  每天 22:00:00 触发一次

- `0 0 3 * * ? 2020`
  2020 年的每天的 03:00:00 触发一次

- `0 0 3 ? * 6L 2019-2021`
  2019 年至 2021 年的每月的最后一个周五的 03:00:00 触发一次

- `0 0-5 14 * * ?`
  每天 14:00 到 14:05 期间每分钟触发一次

- `0 0 13 ? 3 WED`
  每年 3 月的每个周三的 13:00:00 触发一次

- `0 0 13 ? 3 WED-SAT`
  每年 3 月的每个周三、周四、周五、周六的 13:00:00 触发一次

- `0 0 1 1 * ?`
  每月 1 号 01:00:00 触发一次

- `0 0 23 L * ?`
  每月最后一天 23:00:00 触发一次

- `0 0 3 ? * L`
  每周周六 03:00:00 触发一次

- `0 0 3 ? * 6L`
  每月的最后一个周五的 03:00:00 触发一次

- `0 24,30 * * * ?`
  每小时的 24 分和 30 分各触发一次

- `0 0 3 ? * 6#3`
  每月的第 3 个周五的 03:00:00 触发一次


## 参考文献
[1]码农小胖哥.详解定时任务中的 cron 表达式[EB/OL].[https://juejin.im/post/6844904047237955592,2020-01-14](https://juejin.im/post/6844904047237955592),2020-01-14.
[2]Ruthless.cron表达式详解[EB/OL].[https://www.cnblogs.com/linjiqin/p/3178452.html](https://www.cnblogs.com/linjiqin/p/3178452.html),2013-07-08.
